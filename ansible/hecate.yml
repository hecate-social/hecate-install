---
# Hecate Cluster Deployment Playbook (systemd + podman)
#
# Usage:
#   ansible-playbook -i inventory.ini hecate.yml
#
# Tags:
#   --tags common     - Only common setup
#   --tags cluster    - Only cluster nodes
#   --tags inference  - Only inference nodes
#   --tags firewall   - Only firewall rules
#   --tags hecate     - Only Hecate daemon
#
# Skip:
#   --skip-tags firewall - Skip firewall configuration
#

- name: Common setup for all nodes
  hosts: hecate
  tags: [common]
  roles:
    - common

- name: Setup cluster nodes (daemon + reconciler)
  hosts: cluster
  tags: [cluster, hecate]
  roles:
    - hecate-node

- name: Setup inference nodes (Ollama only)
  hosts: inference
  tags: [inference]
  roles:
    - inference

- name: Show cluster status
  hosts: cluster
  tags: [status]
  tasks:
    - name: Get hecate service status
      command: systemctl --user list-units 'hecate-*' --no-pager
      register: services
      changed_when: false

    - name: Display service status
      debug:
        msg: |

          === Hecate Services ===
          {{ services.stdout }}
